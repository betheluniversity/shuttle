{% block body_content %}
    <!-- TODO: grabbing locations from sheets takes some time to load. Is there a way to load this info faster? -->
    <div class="center-page">
        <h4>
            You are scheduled for <span class="badge badge-pill badge-warning location-status">{{ next_location }}</span>
            at <span class="badge badge-pill badge-warning time-status">{{ next_time }}</span>
        </h4>
    </div>
    <div class="card">
        <div class="center-page">
            <div class="align-side-by-side">
                <h4>Arriving at:</h4>
            </div>
            <div class="align-side-by-side">
                <div class="align-side-by-side">
                    <div class="dropdown">
                        <button class="btn btn-primary btn-lg dropdown-toggle arriving-menu" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ next_location }}</button>
                        <div class="dropdown-menu arriving-drop scrollable-menu" aria-labelledby="dropdownMenuButton">
                            {% for key in locations %}
                                <a class="dropdown-item" href="#">{{ locations[key]['location'] }}</a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="align-side-by-side">
                    <input class="btn btn-warning btn-lg submit-arriving" type="submit" value="Submit">
                </div>
            </div>
        </div>
        <div class="center-page">
            <div class="align-side-by-side">
                <h4>Leaving from:</h4>
            </div>
            <div class="align-side-by-side">
                <div class="align-side-by-side">
                    <div class="dropdown">
                        <button class="btn btn-primary btn-lg dropdown-toggle leaving-menu" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ last_location }}</button>
                        <div class="dropdown-menu leaving-drop scrollable-menu" aria-labelledby="dropdownMenuButton">
                            {% for key in locations %}
                                <a class="dropdown-item" href="#">{{ locations[key]['location'] }}</a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="align-side-by-side">
                    <input class="btn btn-warning btn-lg submit-leaving" type="submit" value="Submit">
                </div>
            </div>
        </div>
        <div class="break-section">
            <div class="center-page">
                <div class="align-side-by-side">
                    <div class="submit">
                        <input class="btn btn-warning btn-sm check-out-btn" type="submit" value="Clock out for break">
                    </div>
                </div>
                <div class="align-side-by-side">
                    <div class="submit">
                        <input class="btn btn-warning btn-sm check-in-btn" type="submit" value="Clock in from break">
                    </div>
                </div>
                <div class="break-section">
                    <h4>Current status:<span class="badge badge-light break-badge">{{ current_break_status }}</span></h4>
                </div>
            </div>
        </div>
    </div>

    <script>
        setInterval(check_time, 30000);
            function check_time(){
                var today = new Date();
                var time = today.getHours() + ":" + today.getMinutes();
                if(time >= {{ next_time.split(' ')[0]|tojson }}){
                    location.reload();
            }
        $(document).ready(function() {
            $(".leaving-drop a").click(function () {
                // Dropdown shows leaving location selected
                $(".leaving-menu:first-child").text($(this).text());
                $(".leaving-menu:first-child").val($(this).text());
            });
            $(".arriving-drop a").click(function () {
                // Dropdown shows arriving location selected
                $(".arriving-menu:first-child").text($(this).text());
                $(".arriving-menu:first-child").val($(this).text());
            });
            $('.submit-leaving').click(function () {
                // Sends selected location and user info to database.
                var data = {"location": $('.leaving-menu').text(), "direction": "departure"}
                $.ajax({
                    type: 'POST',
                    contentType: 'application/json',
                    url: "{{ url_for('DriverCheckInView:send_driver_check_in_info') }}",
                    data: JSON.stringify((data)),
                }).done(function (data) {
                    location.reload();
                })
            });
            $('.submit-arriving').click(function () {
                // Sends selected location and user info to database.
                var data = {"location": $('.arriving-menu').text(), "direction": "arrival"}
                $.ajax({
                    type: 'POST',
                    contentType: 'application/json',
                    url: "{{ url_for('DriverCheckInView:send_driver_check_in_info') }}",
                    data: JSON.stringify((data)),
                }).done(function (data) {
                    location.reload();
                })
            });
        });

        $('.check-out-btn').click(function () {
            // Sends break info to database
            var data = {"break": "request-to-clock-out"}
            $.ajax({
                type: 'POST',
                contentType: 'application/json',
                url: "{{ url_for('DriverCheckInView:send_driver_break_info') }}",
                data: JSON.stringify((data)),
            }).done(function (data) {
                location.reload()
            })
        });
        $('.check-in-btn').click(function () {
            // sends check-in from break info to database
            var data = {"break": "request-to-clock-in"}
            $.ajax({
                type: 'POST',
                contentType: 'application/json',
                url: "{{ url_for('DriverCheckInView:send_driver_break_info') }}",
                data: JSON.stringify((data)),
            }).done(function (data) {
                location.reload()
            })
        })
    </script>

{% endblock %}